<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<title>Pregled proizvodnje</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<<style>
:root{
  --bg:#f6f8fb;
  --card:#ffffff;
  --primary:#6c63ff;
  --secondary:#00b894;
  --danger:#ff7675;
  --text:#2d3436;
  --muted:#636e72;
}

body{
  font-family: "Segoe UI", sans-serif;
  margin:10px;
  background:var(--bg);
  color:var(--text);
}

input,select,button{
  margin:4px;
  padding:8px 10px;
  border-radius:6px;
  border:1px solid #dcdde1;
  font-size:14px;
}

input:focus,select:focus{
  outline:none;
  border-color:var(--primary);
}

button{
  background:var(--primary);
  color:#fff;
  border:none;
  cursor:pointer;
  transition:.2s;
}

button:hover{
  opacity:.9;
}

.filter{
  background:var(--card);
  padding:10px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,.05);
  margin-bottom:10px;
  display:flex;
  flex-wrap:wrap;
  align-items:center;
}

.summary{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:#fff;
  padding:12px;
  border-radius:10px;
  margin:10px 0;
  font-weight:bold;
  display:flex;
  justify-content:space-between;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
  background:var(--card);
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 4px 10px rgba(0,0,0,.05);
}

th{
  background:var(--primary);
  color:#fff;
  padding:10px;
}

td{
  padding:8px;
  border-bottom:1px solid #eee;
}

tr:hover{
  background:#f1f3ff;
}

td:nth-child(10){
  font-weight:bold;
  color:var(--secondary);
}

button.danger{
  background:var(--danger);
  padding:6px 10px;
}
</style>

</style>
</head>
<body>

<div class="filter">
  <select id="mesec"></select>
  <select id="godina"></select>
  <input placeholder="Filter komentar" id="filterKomentar">
  <button onclick="render()">Filtriraj</button>
  <input type="number" id="marza" step="0.1" value="90"> % marže
</div>

<div class="summary">
Zarada perioda: <span id="mesecZarada">0</span> |
Sapun potrošen: <span id="mesecSapun">0</span>
</div>

<div>
<input type="date" id="datum">
<input placeholder="Vazna (opis / odakle)" id="vazna">
<input type="number" placeholder="Cena vazne" id="cenaVazne">
<input type="number" placeholder="Gramaža vazne" id="gramaza">
<input type="number" placeholder="Ukupna težina" id="ukTezina">
<input type="number" placeholder="Ostalo" id="ostalo">
<input placeholder="Komentar" id="komentar">
<button onclick="dodaj()">Dodaj</button>
</div>

<table>
<thead>
<tr>
<th>Datum</th>
<th>Vazna</th>
<th>Cena</th>
<th>Gramaža</th>
<th>Uk.tež</th>
<th>Sapun</th>
<th>Ostalo</th>
<th>Ukupno</th>
<th>Prodajna</th>
<th>Zarada</th>
<th>Komentar</th>
<th></th>
</tr>
</thead>
<tbody id="tabela"></tbody>
</table>

<script>
let podaci = JSON.parse(localStorage.getItem("podaci") || "[]");

function initMeseci(){
  let m=document.getElementById("mesec");
  m.innerHTML="";
  ["01","02","03","04","05","06","07","08","09","10","11","12"].forEach((x,i)=>{
    let o=document.createElement("option");
    o.value=x;
    o.text=i+1;
    m.appendChild(o);
  });
  m.value=(new Date().getMonth()+1).toString().padStart(2,"0");
}

function initGodine(){
  let g=document.getElementById("godina");
  g.innerHTML="";

  let godine=new Set();

  // UVEK dodaj 2025
  godine.add("2025");

  podaci.forEach(r=>{
    if(r.datum){
      godine.add(r.datum.split("-")[0]);
    }
  });

  [...godine].sort().forEach(y=>{
    let o=document.createElement("option");
    o.value=y;
    o.text=y;
    g.appendChild(o);
  });

  g.value=new Date().getFullYear().toString();
}

initMeseci();
initGodine();

function dodaj(){
  let r={
    datum: datum.value,
    vazna: vazna.value,
    cena: +cenaVazne.value || 0,
    gram: +gramaza.value || 0,
    uk: +ukTezina.value || 0,
    ost: +ostalo.value || 0,
    kom: komentar.value
  };

  podaci.push(r);
  localStorage.setItem("podaci",JSON.stringify(podaci));
  initGodine();
  render();

  datum.value="";
  vazna.value="";
  cenaVazne.value="";
  gramaza.value="";
  ukTezina.value="";
  ostalo.value="";
  komentar.value="";
}

function obrisi(i){
  podaci.splice(i,1);
  localStorage.setItem("podaci",JSON.stringify(podaci));
  initGodine();
  render();
}

function render(){
  let tb=document.getElementById("tabela");
  tb.innerHTML="";

  let m=document.getElementById("mesec").value;
  let g=document.getElementById("godina").value;
  let fk=document.getElementById("filterKomentar").value.toLowerCase();
  let marza=(+document.getElementById("marza").value || 0)/100;

  let mz=0, ms=0;

  podaci
    .sort((a,b)=>new Date(a.datum)-new Date(b.datum))
    .forEach((r,i)=>{
      if(!r.datum) return;

      let [yy,mm]=r.datum.split("-");
      if(mm!==m || yy!==g) return;

      if(fk && !r.kom.toLowerCase().includes(fk)) return;

      let sap=r.uk-r.gram;
      let ukup=r.cena+sap+r.ost;
      let prod=ukup*(1+marza);
      let zar=prod-ukup;

      mz+=zar;
      ms+=sap;

      let tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${r.datum}</td>
        <td>${r.vazna}</td>
        <td>${r.cena}</td>
        <td>${r.gram}</td>
        <td>${r.uk}</td>
        <td>${sap.toFixed(2)}</td>
        <td>${r.ost}</td>
        <td>${ukup.toFixed(2)}</td>
        <td>${prod.toFixed(2)}</td>
        <td>${zar.toFixed(2)}</td>
        <td>${r.kom}</td>
        <td><button onclick="obrisi(${i})">X</button></td>
      `;
      tb.appendChild(tr);
    });

  mesecZarada.textContent=mz.toFixed(2);
  mesecSapun.textContent=ms.toFixed(2);
}

render();
</script>
</body>
</html>
