<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub-like Project Management</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        async function signIn(email, password) {
            try {
                await signInWithEmailAndPassword(auth, email, password);
                console.log("User signed in");
                fetchUserProjects(auth.currentUser.uid);
            } catch (error) {
                console.error("Error signing in: ", error);
            }
        }

        async function register(email, password) {
            try {
                await createUserWithEmailAndPassword(auth, email, password);
                console.log("User registered");
            } catch (error) {
                console.error("Error registering: ", error);
            }
        }

        async function saveData(userId, projectData) {
            try {
                const docRef = await addDoc(collection(db, "projects"), {
                    userId: userId,
                    ...projectData
                });
                console.log("Document written with ID: ", docRef.id);
                fetchUserProjects(userId); // Refresh projects
            } catch (e) {
                console.error("Error adding document: ", e);
            }
        }

        async function fetchUserProjects(userId) {
            const querySnapshot = await getDocs(collection(db, "projects"));
            const projectsList = document.getElementById("projectsList");
            projectsList.innerHTML = ""; // Clear existing projects

            querySnapshot.forEach((doc) => {
                const data = doc.data();
                if (data.userId === userId) {
                    const li = document.createElement("li");
                    li.textContent = `${data.projectName} - ${data.projectDescription}`;
                    projectsList.appendChild(li);
                }
            });
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("User is signed in:", user);
                fetchUserProjects(user.uid); // Fetch projects when user signs in
            } else {
                console.log("No user is signed in");
            }
        });

        function handleSignIn() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            signIn(email, password);
        }

        function handleRegister() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            register(email, password);
        }

        function handleAddProject() {
            const projectName = document.getElementById("projectName").value;
            const projectDescription = document.getElementById("projectDescription").value;

            if (auth.currentUser) {
                saveData(auth.currentUser.uid, { projectName, projectDescription });
                document.getElementById("projectName").value = "";
                document.getElementById("projectDescription").value = "";
            } else {
                alert("Please sign in to add a project.");
            }
        }

        async function handleSignOut() {
            await signOut(auth);
            console.log("User signed out");
        }
    </script>
</head>
<body>
    <h1>GitHub-like Project Management</h1>

    <div>
        <h2>Sign In / Register</h2>
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Password" required>
        <button onclick="handleSignIn()">Sign In</button>
        <button onclick="handleRegister()">Register</button>
    </div>

    <div>
        <h2>Add a Project</h2>
        <input type="text" id="projectName" placeholder="Project Name" required>
        <input type="text" id="projectDescription" placeholder="Project Description" required>
        <button onclick="handleAddProject()">Add Project</button>
    </div>

    <div>
        <h2>Your Projects</h2>
        <ul id="projectsList"></ul>
    </div>

    <button onclick="handleSignOut()">Sign Out</button>
</body>
</html>
